#!/usr/bin/env node

var http = require('http')
  , port = 3000

var base_url = '127.0.0.1'

var usage    = "usage: cli <method> <model> <category>"
  , argc     = process.argv.length - 1  // wtf extra length batman?
  , method   = process.argv[2]
  , model    = process.argv[3]
  , category = process.argv[4]

if (argc < 4) {
  if (argc < 3) {
    console.log(usage)
    process.exit()
  } else {
    // CAT_LIST - list of categories
    var catList = function(model) {
      var options = {
          host: base_url
        , port: port
        , path: '/' + model
        , method: 'GET'
      }
      var req = http.get(options, function(res) {
        res.on('data', function(d) {
          process.stdout.write(d + '\n')
        })
      })
      req.end()
    }(model)
  }
}


// LIST
if (method == 'list') {
  var options = {
      host: base_url
    , port: port
    , path: '/' + model + '/' + category
    , method: 'GET'
  }
  var req = http.get(options, function(res) {
    res.on('data', function(d) {
      docs = JSON.parse(d)
      writeList(docs)
    })
  })
  req.end()
  req.on('error', function(err) {
    console.log(err)
  })
}

var writeList = function(docs) {
  // receive json list and print to stdout properly
  content_types = ['url', 'content', 'path']
  docs.forEach(function(doc) {
    if (doc.content) {
      body = doc.content
    }
    if (doc.url) {
      body = doc.url
    }
    if (doc.path) {
      body = doc.path
    }
    process.stdout.write(doc.title + '\n' + '\t- ' + body + '\n')
  })
}


